<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Clubhouse Audio Downloader</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://unpkg.com/htmx.org@1.7.0"></script>
    <style type="text/css">
    .skt {
      font-family: 'Sanskrit 2003';
    }
    .row {
      --bs-gutter-x: 0rem;
    }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="m-3 skt text-center">‡§Ö‡§∂‡•ç‡§µ‡§§‡•ç‡§•-‡§ß‡•ç‡§µ‡§®‡§ø‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡§É</h1>
      <form>
      <div class="row shadow p-3 mb-5 bg-body rounded" style="max-width: 100%">
        <div class="col"></div>
        <div class="col-md-4 col-lg-6 me-3">
          <input type="text" name="churl" class="form-input form-control">
        </div>
        <div class="col">
          <input type="submit" name="submit" class="btn btn-success" value="Download" hx-post="/" hx-include="[name='churl']" hx-trigger="click, keydown[returnKey]">
        </div>
      </div>
      </form>

        <div class="row">
          {% for s in all_stats %}
          <div class="col-md-4" id="{{s.chdir}}">

            <div class="card bg-light mb-3 shadow" style="max-width: 18rem;">
              <div class="card-header skt">
                <span class="ms-3">{{s.room}}</span>
                <button type="button" class="btn-close float-end" aria-label="Close" hx-delete="/" hx-target="#{{s.chdir}}" hx-trigger="click" hx-swap="outerHTML" hx-vals='{"sid": "{{s.sid}}"}'></button>
              </div>
              <div class="card-body ms-3">
                <h5 class="card-title skt">{{s.title}}</h5>
                <p class="card-text">
                  <div class="row">
                    <span id="stage_{{s.sid}}">
                    {% for i in range(s.stage) %}
                    üü¶
                    {% endfor %}
                    </span>
                    <div hx-get="/s/{{s.sid}}/stage" hx-target="#stage_{{s.sid}}" hx-swap="innerHTML" {% if s.status == 0 %} hx-trigger="every 10s" {% else %} hx-trigger="click from:#{{s.chdir}}" {% endif %}></div>
                    <div name="duration" style="font-size: 18px" data="{{s.duration}}"></div>
                  </div>

                  <div class="row">
                    <div class="progress" style="height: 20px; width: 200px;" hx-get="/s/{{s.sid}}/progress" {% if s.status == 0 %} hx-trigger="every 5s" {% else %} hx-trigger="click from:#{{s.chdir}}" {% endif %}>
                      <!-- background: #17a2b8" -->
                      <div id="progress_{{s.sid}}" class="progress-bar progress-bar-striped bg-secondary" role="progressbar" style="width: {{s.pc}}%; aria-valuenow="{{s.pc}}" aria-valuemin="0" aria-valuemax="100">{{s.pc}}%</div>
                    </div>
                  </div>
                </p>
                <a href="{{s.churl}}" class="card-link">Web</a>
                {% if s.status == 1 and s.sln %}
                <a target="_blank" href="/static/media/{{s.sln}}" class="card-link">Download</a>
                {% endif %}
              </div>
              <div class="card-footer bg-transparent">
                <span class="ms-3" id="status_{{s.sid}}" hx-get="/s/{{s.sid}}/status" {% if s.status == 0 %} hx-trigger="every 5s" {% else %} hx-trigger="click from:#{{s.chdir}}" {% endif %}>
                {% if s.status == 0 %}
            üü®
            {% elif s.status == 1 %}
            üü©
            {% else %}
            üü•
            {% endif %}

            {{s.msg}}
          </span>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
    </div>

    <script type="text/javascript">
      function time2ISO(seconds) {
       let date = new Date(null);
       date.setSeconds(seconds);
       return date.toISOString().substr(11, 8);
      }

      function showDurations() {
        ds = document.querySelectorAll("[name = 'duration']");
        ds.forEach((d) => {
          d.innerHTML = time2ISO(d.getAttribute("data"));
        });
      }

      showDurations();
    </script>
  </body>
</html>

